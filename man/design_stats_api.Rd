% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/design_stats.R
\name{design_stats_api}
\alias{design_stats_api}
\title{Design Statistics API - Single Engine for ANOVA Computations}
\usage{
design_stats_api(
  data_mat,
  gen_idx,
  rep_idx,
  col_idx = NULL,
  main_idx = NULL,
  design_type = 1L
)
}
\arguments{
\item{data_mat}{Numeric matrix of trait data (n_obs x n_traits)}

\item{gen_idx}{Integer vector of genotype indices (sub-plot treatments in SPD)}

\item{rep_idx}{Integer vector of replication/block indices (RCBD) or row indices (LSD)}

\item{col_idx}{Integer vector of column indices (for LSD, optional)}

\item{main_idx}{Integer vector of main plot indices (for SPD, optional)}

\item{design_type}{Integer design code: 1=RCBD, 2=LSD, 3=SPD}
}
\value{
List with components compatible with legacy .calculate_anova():
  \item{GMS}{Genotype mean squares vector (diagonal of MSG)}
  \item{EMS}{Error mean squares vector (diagonal of MSE)}
  \item{EMS_MAIN}{Main plot error mean squares vector (SPD only, diagonal of MSG_MAIN)}
  \item{DFG}{Degrees of freedom for genotypes/sub-plots}
  \item{DFE}{Degrees of freedom for error (sub-plot error for SPD)}
  \item{DFE_MAIN}{Degrees of freedom for main plot error (SPD only)}
  \item{n_rep}{Number of replications}
  \item{n_gen}{Number of genotypes/sub-plot treatments}
  \item{n_main}{Number of main plot treatments (SPD only)}
  \item{MSG}{Genotype mean square matrix (n_traits x n_traits)}
  \item{MSE}{Error mean square matrix (n_traits x n_traits)}
}
\description{
Unified API for experimental design statistics and ANOVA computations.
Replaces ad-hoc ANOVA calculations throughout the package, providing
a single source of truth for correction factors, sums of products,
degrees of freedom, and mean squares.

This function is a wrapper around design_stats() that computes
multivariate ANOVA statistics (mean square matrices) for all trait
pairs simultaneously.
}
\details{
This function centralizes ANOVA computation logic, eliminating code
duplication across varcov.R, mean_performance.R, and other modules.

**Design-specific formulas:**

RCBD:
- MSG = GSP / (g - 1)
- MSE = ESP / ((g - 1) * (r - 1))

LSD:
- MSG = GSP / (t - 1)
- MSE = ESP / ((t - 1) * (t - 2))

SPD:
- MSG = GSP / (b - 1)  [sub-plot treatments]
- MSE = ESP / (a * (b - 1) * r)  [sub-plot error]
- MSE_MAIN = ESP_MAIN / ((a - 1) * (r - 1))  [main plot error]
}
\keyword{internal}
