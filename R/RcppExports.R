# Generated by using Rcpp::compileAttributes() -> do not edit by hand
# Generator token: 10BE3573-1514-4C36-9D1C-5A225CD40393

#' C++ ANOVA Statistics Iterator
#'
#' @description
#' Optimized C++ implementation for computing ANOVA statistics across multiple traits.
#' Replaces R loop in mean_performance() that calls design_stats() for each trait.
#' Processes all traits in a single pass using vectorized operations.
#'
#' @param data_mat Numeric matrix of trait observations (n_obs x n_traits)
#' @param gen_idx Integer vector of genotype indices (1-based converted to 0-based internally)
#' @param rep_idx Integer vector of replication indices (1-based converted to 0-based internally)
#' @param col_idx Integer vector of column indices for LSD (NULL for RCBD/SPD)
#' @param main_idx Integer vector of main plot indices for SPD (NULL for RCBD/LSD)
#' @param design_type Integer: 1=RCBD, 2=LSD, 3=SPD
#'
#' @return List containing matrices:
#'   - GMS: Genotype Mean Squares (1 x n_traits)
#'   - EMS: Error Mean Squares (1 x n_traits)
#'   - EMS_MAIN: Main plot error mean squares for SPD (1 x n_traits)
#'   - DFG: Degrees of freedom for genotypes (scalar)
#'   - DFE: Degrees of freedom for error (scalar)
#'   - DFE_MAIN: Degrees of freedom for main plot error in SPD (scalar)
#'   - n_rep: Number of replications (scalar)
#'   - n_gen: Number of genotypes (scalar)
#'   - n_main: Number of main plots for SPD (scalar)
#'
#' @details
#' Algorithm optimizations:
#' - Single pass through data for all traits (eliminates R loop overhead)
#' - Pre-computes all grouped sums for reuse across traits
#' - Vectorized operations using Eigen
#' - Returns statistics needed for F-tests, CV%, heritability, etc.
#'
#' @keywords internal
cpp_anova_iterator <- function(data_mat, gen_idx, rep_idx, col_idx = NULL, main_idx = NULL, design_type = 1L) {
    .Call(`_selection_index_cpp_anova_iterator`, data_mat, gen_idx, rep_idx, col_idx, main_idx, design_type)
}

#' C++ Iterator for Selection Index Combinations
#' 
#' Vectorized computation of selection indices for all trait combinations.
#' Replaces R loop with single-pass compiled code for massive speedup.
#' 
#' @param pmat Phenotypic variance-covariance matrix (n x n)
#' @param gmat Genotypic variance-covariance matrix (n x n)
#' @param wmat Weight vector (n x 1) or matrix (n x wcol)
#' @param comb_matrix Matrix of trait combinations (ncomb x ncomb_total)
#'   Each column is one combination (0-indexed trait indices)
#' @param wcol Weight column to use (0-indexed)
#' @param const_factor Constant factor (default: 2.063)
#' @param PRE_constant Constant for PRE calculation (default: 100 or 100/GAY)
#' 
#' @return List with:
#'   - IDs: Character vector of combination IDs
#'   - b_matrix: Matrix of b coefficients (ncomb_total x max_traits)
#'   - GAs: Numeric vector of genetic advances
#'   - PREs: Numeric vector of percent relative efficiencies
#' 
#' @keywords internal
cpp_comb_iterator <- function(pmat, gmat, wmat, comb_matrix, wcol = 0L, const_factor = 2.063, PRE_constant = 100.0) {
    .Call(`_selection_index_cpp_comb_iterator`, pmat, gmat, wmat, comb_matrix, wcol, const_factor, PRE_constant)
}

#' C++ Variance-Covariance Matrix Iterator
#'
#' @description
#' Optimized C++ implementation for computing variance-covariance matrices.
#' Replaces nested R loops in gen_varcov() and phen_varcov() with vectorized
#' operations. Processes all trait pairs in a single call using Eigen for
#' efficient matrix operations.
#'
#' @param data_mat Numeric matrix of trait observations (n_obs x n_traits)
#' @param gen_idx Integer vector of genotype indices (1-based converted to 0-based internally)
#' @param rep_idx Integer vector of replication indices (1-based converted to 0-based internally)
#' @param col_idx Integer vector of column indices for LSD (NULL for RCBD/SPD)
#' @param main_idx Integer vector of main plot indices for SPD (NULL for RCBD/LSD)
#' @param design_type Integer: 1=RCBD, 2=LSD, 3=SPD
#' @param cov_type Integer: 1=genotypic, 2=phenotypic
#'
#' @return Symmetric variance-covariance matrix (n_traits x n_traits)
#'
#' @details
#' Algorithm optimizations:
#' - Single pass through data for all trait pairs (eliminates R loop overhead)
#' - Uses Eigen's efficient matrix operations (crossprod, grouped sums)
#' - Pre-allocates all result matrices (no memory reallocation)
#' - Computes only upper triangle, then mirrors to lower (symmetric matrix)
#'
#' RCBD: Cov_G = (GMP - EMP) / r, Cov_P = Cov_G + EMP
#' LSD:  Cov_G = (GMP - EMP) / t, Cov_P = Cov_G + EMP  
#' SPD:  Cov_G = (GMP - EMP) / (r*a), Cov_P = Cov_G + EMP
#'
#' @keywords internal
cpp_varcov_iterator <- function(data_mat, gen_idx, rep_idx, col_idx = NULL, main_idx = NULL, design_type = 1L, cov_type = 1L) {
    .Call(`_selection_index_cpp_varcov_iterator`, data_mat, gen_idx, rep_idx, col_idx, main_idx, design_type, cov_type)
}

